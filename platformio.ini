; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html
; ========================================================================
; Proyecto:   AcelerometroIoT
; Autor:      Juan Francisco Sepúlveda Lastra, Ariel Aguirre R.
; Repositorio: https://github.com/arielaar/AcelerometroIoT
; Descripción:
;   Configuración profesional de PlatformIO para desarrollo embebido
;   con ESP32 (Heltec WiFi LoRa 32 V3 y ESP32 DevKit).
;
;   Incluye:
;       - Entornos Debug y Release para Heltec (producción y desarrollo)
;       - Entorno Debug para ESP32 DevKit
;       - Librerías locales para trabajar sin conexión a Internet
;       - Soporte para WebServer asíncrono, LoRa SX1262, MPU9250, SHT31, RTC
; ========================================================================

[platformio]
; Entorno por defecto al compilar
default_envs = esp32dev ; heltec_wifi_lora_32_V3_release ; heltec_wifi_lora_32_V3_debug ; 

; ------------------------------------------------------------------------
; Librerías compartidas entre todos los entornos
; Nota: Todas están en la carpeta lib/ del repositorio
; ------------------------------------------------------------------------
[common]
lib_deps = 
    ; ===== WebServer y red =====
    lib/ESP Async WebServer           ; WebServer asíncrono para ESP32
    lib/AsyncTCP                      ; Necesaria para ESPAsyncWebServer en ESP32
    WiFi                              ; Librería core de Arduino-ESP32
    lib/ESP32Ping-1.6                 ; Ping ICMP para diagnóstico de red

    ; ===== JSON =====
    lib/ArduinoJson-6.21.5            ; Manejo de JSON para WebSocket/REST

    ; ===== Sensores y periféricos =====
    ;lib/MPU9250_asukiaaa-master       ; IMU MPU9250
    ;lib/Adafruit_SHT31-master         ; Sensor de temperatura/humedad SHT31
    ;lib/RTClib-master                 ; RTC DS3231
    ;lib/Adafruit_BusIO-1.17.2         ; Dependencia para RTClib y SHT31

    ; ===== Pantallas =====
    ;lib/U8g2_Arduino-2.35.30          ; Manejo de pantallas OLED

; ========================================================================
; Configuración base para Heltec WiFi LoRa 32 V3
; ------------------------------------------------------------------------
;   Esta sección define parámetros comunes a Debug y Release
;   para evitar duplicación. Los entornos heredarán esta configuración.
; ========================================================================
[env:heltec_wifi_lora_32_V3_base]
platform = espressif32
board = heltec_wifi_lora_32_V3
framework = arduino

; --- Microcontrolador ESP32-S3 ---
board_build.mcu = esp32s3
board_build.f_cpu = 240000000L

; --- Memoria y PSRAM ---
board_build.flash_mode = dio
board_build.flash_size = 8MB
;board_build.psram_type = octal  ; Se comento por que la placa no Posee PSRAM

; --- Sistema de archivos y particiones ---
board_build.partitions = huge_app.csv   ; Permite firmware grande (WebServer + LoRa)
board_build.filesystem = littlefs

; --- Velocidades de monitor y carga ---
monitor_speed = 115200
upload_speed = 921600
monitor_filters = esp32_exception_decoder ; Decodificación de stacktrace

; --- Librerías compartidas ---
lib_deps =
    ${common.lib_deps}

; --- Flags comunes ---
build_flags =
    -std=gnu++17                       ; Compilación en C++17
    -DUSE_U8G2                         ; Activa soporte para OLED U8g2
    -DASYNCWEBSERVER_REGEX             ; Regex en WebServer
    ;-DBOARD_HAS_PSRAM                  ; Habilita PSRAM

build_unflags = 
    -std=gnu++11                       ; Evita usar estándar antiguo

; ========================================================================
; ENTORNO DEBUG: Desarrollo
; - Logs detallados
; - Binario más grande y lento (no optimizado)
; ========================================================================
[env:heltec_wifi_lora_32_V3_debug]
extends = env:heltec_wifi_lora_32_V3_base
build_type = debug
build_flags =
    ${env:heltec_wifi_lora_32_V3_base.build_flags}
    -DCORE_DEBUG_LEVEL=5               ; Log máximo para depuración

; ========================================================================
; ENTORNO RELEASE: Producción
; - Optimizado para velocidad y tamaño
; - Logs mínimos
; ========================================================================
[env:heltec_wifi_lora_32_V3_release]
extends = env:heltec_wifi_lora_32_V3_base
build_type = release
build_flags =
    ${env:heltec_wifi_lora_32_V3_base.build_flags}
    -DCORE_DEBUG_LEVEL=0               ; Sin logs en producción

; ========================================================================
; ENTORNO ESP32 DevKit (solo Debug)
; - Para pruebas sin LoRa, sensores y webserver
; ========================================================================
[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino

; --- Monitor serie ---
monitor_speed = 115200
upload_speed = 921600

; --- Librerías ---
lib_deps =
    ${common.lib_deps}

; --- Flags para debug ---
build_type = debug
build_flags =
    -std=gnu++17
    -DUSE_U8G2
    -DASYNCWEBSERVER_REGEX
    -DCORE_DEBUG_LEVEL=5

build_unflags = 
    -std=gnu++11
; ========================================================================
; Fin de la configuración
; ========================================================================